# Allwinner V821 (sun300iw1p1) 外设地址映射表

本文档整理了V821芯片的主要外设物理地址，方便开发时查阅。

## 核心控制器

| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| AON CCU | 0x4a010000 | Always-On Clock Control Unit (常开时钟控制单元) |
| APP CCU | 0x42001000 | Application Clock Control Unit (应用时钟控制单元) |
| PRCM CCU | 0x4a000000 | Power/Reset/Clock Management (电源/复位/时钟管理) |
| PLIC | 0x48000000 | Platform-Level Interrupt Controller (平台级中断控制器) |
| L2 Cache | 0x49000000 | L2缓存控制器 |
| MBUS Controller | 0x43102000 | 内存总线控制器 |

## 串口 (UART)

| 外设名称 | 物理地址 | 设备节点 |
|---------|----------|----------|
| UART0 | 0x42500000 | /dev/ttyAS0 |
| UART1 | 0x42500400 | /dev/ttyAS1 |
| UART2 | 0x42500800 | /dev/ttyAS2 |
| UART3 | 0x42500c00 | /dev/ttyAS3 |

## I2C/TWI (Two Wire Interface)

| 外设名称 | 物理地址 | I2C总线号 | 引脚 |
|---------|----------|-----------|------|
| TWI0 | 0x42502000 | i2c-0 | PA3(SCL), PA4(SDA) |
| TWI1 | 0x42502400 | i2c-1 | - |
| TWI2 | 0x42502800 | i2c-2 | - |

## SPI

| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| SPI0 | 0x44025000 | 通用SPI接口0 |
| SPI1 | 0x44026000 | 通用SPI接口1 |
| SPI2 | 0x44027000 | 通用SPI接口2 |
| SPIF0 | 0x44f00000 | SPI Flash控制器 |

## 视频输入子系统 (VIN)

### 主控制器
| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| VIND0 | 0x45800800 | Video Input Device (视频输入设备主控) |

### CSI接口 (Camera Serial Interface)
| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| CSI0 | 0x45820000 | CSI接口0 (MIPI CSI-2) |
| CSI1 | 0x45821000 | CSI接口1 (并行/BT656) |

### MIPI接口
| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| MIPI0 | 0x45810100 | MIPI D-PHY 0 |
| MIPI1 | 0x45810200 | MIPI D-PHY 1 |

### ISP (Image Signal Processor)
| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| ISP00 | 0x45900000 | ISP核心0 |
| ISP01 | 0x458ffffc | ISP核心0辅助 |

### Scaler (图像缩放器)
| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| SCALER00 | 0x45910000 | 缩放器通道0 |
| SCALER01 | 0x4590fffc | 缩放器通道0辅助 |
| SCALER10 | 0x45910400 | 缩放器通道1 |
| SCALER11 | 0x459103fc | 缩放器通道1辅助 |

### VINC (Video Input Capture)
| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| VINC00 | 0x45830000 | 视频捕获通道0 |
| VINC01 | 0x4582fffc | 视频捕获通道0辅助 |
| VINC10 | 0x45831000 | 视频捕获通道1 |
| VINC11 | 0x45830ffc | 视频捕获通道1辅助 |

### TDM (Time Division Multiplexing)
| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| TDM0 | 0x45908000 | 时分复用接口 |

## 显示子系统

| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| DISP | 0x45000000 | Display Engine (显示引擎) |

## 存储控制器

| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| SDC0 | 0x44020000 | SD/MMC控制器0 |
| SDC1 | 0x44021000 | SD/MMC控制器1 |
| SID | 0x43006000 | Security ID (芯片唯一ID) |
| SRAM Controller | 0x43000000 | SRAM控制器 |

## USB

| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| UDC | 0x44100000 | USB Device Controller (USB设备控制器) |
| EHCI0 | 0x44101000 | USB 2.0 Host Controller |
| OHCI0 | 0x44101400 | USB 1.1 Host Controller |

## 音频

| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| Codec | 0x42030000 | 音频编解码器 |
| I2S0 | 0x42032000 | I2S接口0 |

## 网络

| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| GMAC0 | 0x44500000 | Gigabit Ethernet MAC |
| MDIO0 | 0x44500048 | MDIO接口 (PHY管理) |

## GPIO和PWM

| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| PIO | 0x42000000 | 通用GPIO控制器 |
| RTC PIO | 0x42000540 | RTC域GPIO |
| IRCUT | 0x42000358 | 红外滤光片控制 |
| PWM0 | 0x42000c00 | PWM控制器基地址 |
| PWM0_0 ~ PWM0_11 | 0x42000c10 ~ 0x42000c1b | PWM通道0-11 |

## DMA

| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| DMA | 0x43002000 | 通用DMA控制器 |
| NDMA | 0x43001000 | Normal DMA控制器 |

## 定时器和看门狗

| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| Timer0 | 0x43008000 | 系统定时器 |
| Watchdog | 0x4a001000 | 看门狗定时器 |
| RTC | 0x4a000c00 | 实时时钟 |

## 多媒体加速器

| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| G2D | 0x45410000 | 2D图形加速器 |
| VE | 0x41c0e000 | Video Engine (视频编解码加速器) |
| RT-Media | 0x41c0e000 | 实时媒体处理 |

## 安全相关

| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| Crypto Engine | 0x43044000 | 加密引擎 |
| TRNG | 0x42059000 | True Random Number Generator (真随机数发生器) |

## 电源管理

| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| PMU | 0x4a000800 | Power Management Unit |
| THS | 0x42009400 | Thermal Sensor (温度传感器) |
| GPADC | 0x42009000 | General Purpose ADC |

## 多核通信

| 外设名称 | 物理地址 | 说明 |
|---------|----------|------|
| Msgbox | 0x43033000 | 核间消息邮箱 |
| Hwspinlock | 0x43005000 | 硬件自旋锁 |
| AMP Timestamp | 0x43032000 | 非对称多核时间戳 |
| E907 RPROC | 0x43030000 | E907协处理器控制 |

## 内存映射

### 预留内存区域
| 区域 | 物理地址 | 大小 | 说明 |
|------|----------|------|------|
| OpenSBI | 0x80fc0000 | 256KB (0x40000) | RISC-V OpenSBI固件 |
| eFuse RAM | 0x80ffff00 | 256B (0x100) | eFuse缓存区 |
| Main Memory | 0x80000000 | 64MB (0x04000000) | 主内存起始地址 |

## 查看方法

### 1. 查看设备树源文件（最完整）
```bash
# 查看SoC级别的外设定义
cat /home/f/tina/tina-v821-release/bsp/configs/linux-5.4-ansc/sun300iw1p1.dtsi

# 查看板级配置
cat /home/f/tina/tina-v821-release/device/config/chips/v821/configs/avaota_f1/linux-5.4-ansc/board.dts
```

### 2. 运行时查看已启用的外设映射
```bash
cat /proc/iomem
```

**注意**: `/proc/iomem` 只显示实际启用并映射的外设，未启用的外设不会出现。

示例输出：
```
42000000-420004ff : pinctrl@42000000           # GPIO控制器
42502000-425023ff : twi0@42502000              # I2C0 (摄像头使用)
42500000-425003ff : uart-ng                    # UART0 (串口)
4a000800-4a000893 : soc_pmu0@4A000800          # PMU (电源管理)
```

### 3. 查看特定外设寄存器（需root权限）
```bash
# 需要devmem工具
devmem 0x42502000        # 读取TWI0基地址寄存器
devmem 0x42502000 32 0x1 # 写入寄存器（危险操作）
```

### 4. 通过dmesg查看驱动探测信息
```bash
dmesg | grep -E "vin:|csi|mipi|twi"
```

### 5. 查看V4L2视频设备（摄像头相关）
```bash
ls -l /dev/video*        # 查看视频设备节点
v4l2-ctl --list-devices  # 查看V4L2设备详情
```

## 当前系统已启用的外设（从 /proc/iomem）

根据实际运行的系统，以下外设已经启用并映射到内存：

| 地址范围 | 外设 | 状态 |
|---------|------|------|
| 42000000-420004ff | GPIO/PIO (pinctrl@42000000) | ✅ 已启用 |
| 42000540-4200063f | RTC GPIO (pinctrl@42000540) | ✅ 已启用 |
| 42000c00-42000fff | PWM0 (pwm@42000c00) | ✅ 已启用 |
| 42009000-420093ff | GPADC (gpadc0@42009000) | ✅ 已启用 |
| 42009400-420097ff | 温度传感器 (ths@42009400) | ✅ 已启用 |
| 42030000-42030347 | 音频Codec (sunxi-snd-codec) | ✅ 已启用 |
| 42032000-4203207b | I2S (sunxi-snd-plat-i2s) | ✅ 已启用 |
| 42500000-425003ff | UART0 (uart-ng) | ✅ 已启用 |
| 42502000-425023ff | **TWI0/I2C0** (twi0@42502000) | ✅ 已启用 (摄像头使用) |
| 43002000-43002fff | DMA控制器 (dma-controller) | ✅ 已启用 |
| 43030000-43030fff | E907协处理器 (rv-cfg) | ✅ 已启用 |
| 43033000-43033fff | 消息邮箱 (msgbox) | ✅ 已启用 |
| 44020000-44020fff | SD卡控制器 (sdmmc) | ✅ 已启用 |
| 44f00000-44f00fff | SPI Flash (spif) | ✅ 已启用 |
| 4a000800-4a000893 | **PMU电源管理** (soc_pmu0) | ✅ 已启用 |
| 4a000c00-4a000ffe | RTC实时时钟 (rtc) | ✅ 已启用 |
| 4a001000-4a00101f | 看门狗 (watchdog) | ✅ 已启用 |

### 摄像头相关外设状态

| 外设 | 地址 | /proc/iomem显示 | 状态 |
|------|------|----------------|------|
| TWI0 (I2C) | 0x42502000 | ✅ 显示 | 已启用 |
| CSI0 | 0x45820000 | ❌ 未显示 | 未完全初始化 |
| VIND0 | 0x45800800 | ❌ 未显示 | 未完全初始化 |
| MIPI0 | 0x45810100 | ❌ 未显示 | 未完全初始化 |
| ISP00 | 0x45900000 | ❌ 未显示 | 未完全初始化 |

**分析**: I2C总线已正常启用，但摄像头VIN子系统的外设未在 `/proc/iomem` 中显示，说明驱动可能未成功探测或初始化这些硬件模块。

## 常见外设组合应用

### GC02M1摄像头模块涉及的地址
- **TWI0** (0x42502000): I2C通信配置摄像头寄存器
- **CSI0** (0x45820000): 接收MIPI数据
- **MIPI0** (0x45810100): MIPI物理层
- **ISP00** (0x45900000): 图像信号处理
- **VINC00** (0x45830000): 视频数据捕获
- **VIND0** (0x45800800): 视频输入设备管理

### 网络应用涉及的地址
- **GMAC0** (0x44500000): 以太网MAC
- **MDIO0** (0x44500048): PHY管理接口
- **DMA** (0x43002000): 数据传输加速

### USB存储涉及的地址
- **EHCI0** (0x44101000): USB2.0主机
- **DMA** (0x43002000): 批量数据传输

---

**文档生成时间**: 2025-11-14
**芯片型号**: Allwinner V821 (sun300iw1p1)
**架构**: RISC-V 32位
**来源**: device tree文件 `sun300iw1p1.dtsi`
